#
# Copyright 2025 Tabs Data Inc.
#

[tasks.__os__start_test_py]
plugin = "td-task-tracker"
category = "04 - Test"
private = true
script_runner = "@duckscript"
script = [
    '''
    !include_files ./make/make-os/libraries/log.ds

    arguments = split ${CARGO_MAKE_TASK_ARGS} ;
    for argument in ${arguments}
        if eq ${argument} "--fail-fast-py"
            info "‚åõÔ∏è Fail-Fast enabled. Groups of Python tests will execute until some group has failures."
            set_env TD_FAIL_FAST_PY true
        else
            set_env TD_FAIL_FAST_PY false
        end
    end
    set_env TD_TESTS_CODE_PY 0

    td_symlink_polars_libs = get_env TD_SYMLINK_POLARS_LIBS
    if eq ${td_symlink_polars_libs} "true"
        set_env TD_SYMLINK_POLARS_LIBS_PYTEST true
        info "üîó Setting TD_SYMLINK_POLARS_LIBS_PYTEST to true as TD_SYMLINK_POLARS_LIBS is also set to true"
    end
    ''']

[tasks.__os__stop_test_py]
plugin = "td-task-tracker"
category = "04 - Test"
private = true
script_runner = "@duckscript"
script = [
    '''
    !include_files ./make/make-os/libraries/log.ds

    exit_code = get_env TD_TESTS_CODE_PY
    if not eq ${exit_code} "0"
        info "‚åõÔ∏è Marking py tests run as failed: '${exit_code}'"
        code = exit ${exit_code}
    else
        info "‚åõÔ∏è Marking py tests run as successful: '${exit_code}'"
        exit 0
    end
    ''']
