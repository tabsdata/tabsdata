#
# Copyright 2025 Tabs Data Inc.
#

[plugins.impl.td-task-tracker]
script ='''
    !include_files ./make/make-os/libraries/log.ds

    td_skip_env = concat "skip_" ${task.name}
    td_skip_task = get_env ${td_skip_env}

    start_ms = current_time

    if is_empty ${td_skip_task}
        cm_plugin_run_task
    else
        warn "Ж Skipping task '${task.name}' as configured by environment variable '${td_skip_env}'"
    end

    end_ms = current_time

    elapsed_ms = calc ${end_ms} - ${start_ms}
    elapsed_time = exec --fail-on-error python -c "from datetime import timedelta; import sys; print(timedelta(milliseconds=int(sys.argv[1])))" ${elapsed_ms}
    elapsed_time = trim ${elapsed_time.stdout}

    td_monintor_make = get_env TD_MONITOR_MAKE
    if eq ${td_monintor_make} "true"
        info "路路路路路 憋 Elapsed time: ${elapsed_time} 锔 ${task.name}"
    end
    '''
